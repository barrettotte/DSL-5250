// TODO: doesn't work correctly - missing bytes somewhere along the way...

tasks.register('getTN5250J'){
  new File('lib').mkdirs()
  def tn5250 = new File("lib/tn5250j-${tn5250Version}-full-bin.zip")
  println "Downloading tn5250j-${tn5250Version}-full-bin.zip ..."

  tn5250.withOutputStream{out ->
    def zipUrl = 'https://github.com/tn5250j/tn5250j/releases/download' +
                 "/${tn5250Version}/tn5250j-${tn5250Version}-full-bin.zip"
    new URL(zipUrl).eachByte{b->
      out.write(b)
    }
  }
  def zip = new java.util.zip.ZipFile(tn5250)
  println 'Unzipping...'
  zip.entries().each{e->
    if(!e.isDirectory()){
      def f = new File('lib' + File.separator + e.name)
      new File(f.parent).mkdirs()
      def fos = new FileOutputStream(f)
      def buf = new byte[e.size]
      fos.write(buf, 0, zip.getInputStream(e).read(buf))
      fos.close()
    }
  }
  zip.close()
  delete "lib/tn5250j-${tn5250Version}-full-bin.zip"
  println 'Successfully downloaded TN5250J !'
}
